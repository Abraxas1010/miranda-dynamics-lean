<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miranda Dynamics: Heyting Algebras Meet Seismic Waves</title>

  <!-- CesiumJS for 3D Globe -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

  <!-- Chart.js for calibration plots -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Custom styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <h1>Miranda Dynamics: TKFT Validation</h1>
    <p class="subtitle">Visualizing how Heyting algebras describe physical epistemology</p>
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-value">92.86%</span>
        <span class="stat-label">Accuracy</span>
      </div>
      <div class="stat">
        <span class="stat-value">7.14%</span>
        <span class="stat-label">Heyting Gap</span>
      </div>
      <div class="stat">
        <span class="stat-value">4.27s</span>
        <span class="stat-label">Mean |Dt|</span>
      </div>
    </div>
  </header>

  <!-- Main visualization container -->
  <main class="main-container">

    <!-- Left panel: 3D Globe -->
    <section class="globe-panel">
      <div class="panel-header">
        <h2>Seismic Wave Propagation</h2>
        <div class="event-selector">
          <label>Event:</label>
          <select id="event-select">
            <option value="us7000rqjy">M6.0 New Caledonia (2026-01-19)</option>
            <option value="us7000rq0d">M6.0 Oregon Offshore (2026-01-16)</option>
            <option value="us7000rpcg">M6.2 Kuril Islands (2026-01-13)</option>
          </select>
        </div>
      </div>
      <div id="cesium-container"></div>

      <!-- Timeline scrubber -->
      <div class="timeline-container">
        <button id="play-pause-btn" class="play-btn">Play</button>
        <input type="range" id="time-slider" min="0" max="1200" value="100">
        <span id="time-display">T+1:40</span>
        <div class="speed-control">
          <label>Speed:</label>
          <select id="speed-select">
            <option value="1">1x</option>
            <option value="5">5x</option>
            <option value="10" selected>10x</option>
            <option value="20">20x</option>
            <option value="50">50x</option>
          </select>
        </div>
      </div>

      <!-- Legend -->
      <div class="legend">
        <div class="legend-item">
          <span class="legend-dot green"></span>
          <span>j(P) = P : Predicted & Detected</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot amber pulse"></span>
          <span>j(P) &lt; P : Heyting Gap (predicted, not detected)</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot red"></span>
          <span>j(P) &gt; P : Error (not predicted, detected)</span>
        </div>
        <div class="legend-item">
          <span class="legend-ring green"></span>
          <span>P-wave front</span>
        </div>
        <div class="legend-item">
          <span class="legend-ring red"></span>
          <span>S-wave front</span>
        </div>
      </div>
    </section>

    <!-- Right panel: Billiard + Info -->
    <section class="side-panel">

      <!-- Wave Type Explanation -->
      <div class="billiard-panel">
        <h3>Seismic Wave Types</h3>
        <div class="wave-info-box">
          <div class="wave-info-item">
            <span class="wave-dot p-wave"></span>
            <div class="wave-text">
              <strong>P-wave (Primary)</strong>
              <span>Compressional wave traveling ~8 km/s through Earth's crust. First to arrive at seismic stations.</span>
            </div>
          </div>
          <div class="wave-info-item">
            <span class="wave-dot s-wave"></span>
            <div class="wave-text">
              <strong>S-wave (Secondary)</strong>
              <span>Shear wave traveling ~4.5 km/s. Arrives after P-wave due to slower velocity.</span>
            </div>
          </div>
        </div>
        <p class="panel-description">
          The expanding rings show wave fronts propagating from the epicenter. Station colors change when waves arrive.
        </p>
      </div>

      <!-- Billiard Simulation -->
      <div class="billiard-panel">
        <h3>Billiard Calibration System</h3>
        <p class="panel-description">
          In this reversible system, <strong>all information loss comes from observation</strong>.
          This isolates the nucleus operator j.
        </p>
        <p class="panel-description" style="font-size: 0.75rem; color: var(--text-muted); font-style: italic;">
          Note: This simplified simulation demonstrates the nucleus operator (observation kernel),
          not the Turing-complete construction from Miranda-Ramos 2025. For computational
          universality, see <code>Billiards/CantorEncoding.lean</code>.
        </p>
        <canvas id="billiard-canvas" width="400" height="300"></canvas>
        <div class="billiard-controls">
          <label>Observation Precision:</label>
          <input type="range" id="precision-slider" min="1" max="5" value="3">
          <span id="precision-display">3 decimal places</span>
        </div>
        <div class="billiard-stats">
          <div class="stat-small">
            <span class="stat-label">True Position:</span>
            <span id="true-position">-</span>
          </div>
          <div class="stat-small">
            <span class="stat-label">Observed Position:</span>
            <span id="observed-position">-</span>
          </div>
          <div class="stat-small">
            <span class="stat-label">Information Gap:</span>
            <span id="billiard-gap">-</span>
          </div>
        </div>
      </div>

      <!-- Calibration Transfer -->
      <div class="calibration-panel">
        <h3>Calibration Transfer</h3>
        <p class="panel-description">
          Billiard precision to Seismic SNR threshold (R^2 = 0.9706)
        </p>
        <canvas id="calibration-chart" width="400" height="200"></canvas>
        <div class="calibration-result">
          <span>Recommended SNR Threshold:</span>
          <strong>3.0</strong>
        </div>
      </div>

      <!-- Station Details (updates on hover/click) -->
      <div class="station-details" id="station-details">
        <h3>Station Details</h3>
        <p class="hint">Click a station on the globe to see details</p>
        <div class="details-content" id="details-content" style="display:none;">
          <div class="detail-row">
            <span class="detail-label">Station:</span>
            <span id="detail-station">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Category:</span>
            <span id="detail-category">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Predicted Arrival:</span>
            <span id="detail-predicted">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Observed Arrival:</span>
            <span id="detail-observed">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Timing Error (Dt):</span>
            <span id="detail-error">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">SNR:</span>
            <span id="detail-snr">-</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Heyting Gap Modal (dramatic reveal) -->
  <div id="heyting-gap-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>HEYTING GAP DETECTED</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="gap-equation">
          <span class="eq-term">j(P)</span>
          <span class="eq-operator">&lt;</span>
          <span class="eq-term">P</span>
        </div>
        <p class="gap-explanation">
          The wave <strong>truly arrived</strong> at station IU.SNZO,
          but fell <strong>below the detection threshold</strong>.
        </p>
        <div class="gap-details">
          <div class="gap-detail">
            <span class="gap-label">Signal-to-Noise Ratio:</span>
            <span class="gap-value snr-low">2.1</span>
            <span class="gap-threshold">(threshold: 3.0)</span>
          </div>
          <div class="gap-detail">
            <span class="gap-label">Predicted Arrival:</span>
            <span class="gap-value">756.3s</span>
          </div>
          <div class="gap-detail">
            <span class="gap-label">Observed:</span>
            <span class="gap-value gap-none">NOT DETECTED</span>
          </div>
        </div>
        <div class="gap-interpretation">
          <h4>What This Means</h4>
          <p>
            This is <strong>not a model failure</strong>. This is the <strong>Heyting algebra working correctly</strong>.
          </p>
          <p>
            In intuitionistic logic, we distinguish between:
          </p>
          <ul>
            <li><strong>P</strong> = "The wave truly reached the station" (physical fact)</li>
            <li><strong>j(P)</strong> = "We can verify the wave reached" (observable fact)</li>
            <li><strong>P and not j(P)</strong> = "True but unverifiable" (the gap)</li>
          </ul>
          <p>
            The 7.14% Heyting gap rate <strong>quantifies irreducible epistemic uncertainty</strong> -
            the price of finite observation.
          </p>
        </div>
        <button class="modal-btn" id="close-gap-modal">Continue Simulation</button>
      </div>
    </div>
  </div>

  <!-- Billiard Explainer Modal -->
  <div id="billiard-modal" class="modal hidden">
    <div class="modal-content billiard-explainer">
      <div class="modal-header">
        <h2>Why Billiards?</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="comparison-table">
          <div class="comparison-col">
            <h4>Seismic System</h4>
            <ul>
              <li>Complex 3D wave equation</li>
              <li>Heterogeneous Earth</li>
              <li>Information loss in <strong>dynamics</strong></li>
              <li>Information loss in <strong>observation</strong></li>
            </ul>
          </div>
          <div class="comparison-col">
            <h4>Billiard System</h4>
            <ul>
              <li>Simple elastic collision</li>
              <li>Perfectly reversible</li>
              <li><strong>No</strong> information loss in dynamics</li>
              <li><strong>Only</strong> observation loss</li>
            </ul>
          </div>
        </div>
        <p class="explainer-conclusion">
          The billiard system <strong>isolates the nucleus operator</strong>.
          By calibrating here, we can separate observational uncertainty from dynamical complexity.
        </p>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
